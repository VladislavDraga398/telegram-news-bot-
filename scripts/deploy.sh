#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–µ–ø–ª–æ—è Telegram-–±–æ—Ç–∞

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è Telegram-–±–æ—Ç–∞..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞..."
make stop || true

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
echo "‚¨áÔ∏è –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
git pull

# –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
echo "üèóÔ∏è –°–æ–±–∏—Ä–∞–µ–º Docker-–æ–±—Ä–∞–∑..."
make docker-build

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä..."
make docker-stop || true

# –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä..."
make docker-run

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
sleep 5
./scripts/docker-healthcheck.sh

echo "‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!"
